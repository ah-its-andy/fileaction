version: '3.8'

services:
  # Development version with Alpine
  fileaction-dev-alpine:
    build:
      context: .
      dockerfile: build/dev/Dockerfile.alpine
    container_name: fileaction-dev-alpine
    ports:
      - "3000:3000"
    volumes:
      # Mount source code for live development
      - .:/app
      # Mount config
      - ./config:/app/config
      # Mount data directory
      - ./data:/app/data
      # Cache Go modules to speed up rebuilds
      - go-mod-cache:/go/pkg/mod
    environment:
      - GO111MODULE=on
      - CGO_ENABLED=0
      - TZ=Asia/Shanghai
    working_dir: /app
    command: go run main.go
    restart: unless-stopped
    profiles:
      - dev-alpine

  # Development version with Debian
  fileaction-dev-debian:
    build:
      context: .
      dockerfile: build/dev/Dockerfile.debian
    container_name: fileaction-dev-debian
    ports:
      - "3000:3000"
    volumes:
      # Mount source code for live development
      - .:/app
      # Mount config
      - ./config:/app/config
      # Mount data directory
      - ./data:/app/data
      # Cache Go modules to speed up rebuilds
      - go-mod-cache:/go/pkg/mod
    environment:
      - GO111MODULE=on
      - CGO_ENABLED=0
      - TZ=Asia/Shanghai
    working_dir: /app
    command: go run main.go
    restart: unless-stopped
    profiles:
      - dev-debian

  # Development version with hot-reload using Air (Alpine)
  fileaction-dev-air-alpine:
    build:
      context: .
      dockerfile: build/dev/Dockerfile.alpine
    container_name: fileaction-dev-air-alpine
    ports:
      - "3000:3000"
    volumes:
      # Mount source code for live development
      - .:/app
      # Mount config
      - ./config:/app/config
      # Mount data directory
      - ./data:/app/data
      # Cache Go modules to speed up rebuilds
      - go-mod-cache:/go/pkg/mod
    environment:
      - GO111MODULE=on
      - CGO_ENABLED=0
      - TZ=Asia/Shanghai
    working_dir: /app
    command: air -c .air.toml
    restart: unless-stopped
    profiles:
      - dev-air-alpine

  # Development version with hot-reload using Air (Debian)
  fileaction-dev-air-debian:
    build:
      context: .
      dockerfile: build/dev/Dockerfile.debian
    container_name: fileaction-dev-air-debian
    ports:
      - "3000:3000"
    volumes:
      # Mount source code for live development
      - .:/app
      # Mount config
      - ./config:/app/config
      # Mount data directory
      - ./data:/app/data
      # Cache Go modules to speed up rebuilds
      - go-mod-cache:/go/pkg/mod
    environment:
      - GO111MODULE=on
      - CGO_ENABLED=0
      - TZ=Asia/Shanghai
    working_dir: /app
    command: air -c .air.toml
    restart: unless-stopped
    profiles:
      - dev-air-debian

volumes:
  go-mod-cache:
    driver: local
